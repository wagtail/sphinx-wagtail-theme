!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).autocomplete=t()}(this,function(){"use strict";return function(a){var l,o,s=document,d=s.createElement("div"),c=d.style,e=navigator.userAgent,t=-1!==e.indexOf("Firefox")&&-1!==e.indexOf("Mobile"),i=a.debounceWaitMs||0,r=a.preventSubmit||!1,n=t?"input":"keyup",u=[],p="",f=2,v=a.showOnFocus,m=0;if(void 0!==a.minLength&&(f=a.minLength),!a.input)throw new Error("input undefined");var g=a.input;function h(){o&&window.clearTimeout(o)}function E(){return!!d.parentNode}function w(){var e;m++,u=[],p="",l=void 0,(e=d.parentNode)&&e.removeChild(d)}function L(){for(;d.firstChild;)d.removeChild(d.firstChild);var o=function(e,t){var n=s.createElement("div");return n.textContent=e.label||"",n};a.render&&(o=a.render);var i=function(e,t){var n=s.createElement("div");return n.textContent=e,n};a.renderGroup&&(i=a.renderGroup);var r=s.createDocumentFragment(),f="#9?$";if(u.forEach(function(t){if(t.group&&t.group!==f){f=t.group;var e=i(t.group,p);e&&(e.className+=" group",r.appendChild(e))}var n=o(t,p);n&&(n.addEventListener("click",function(e){a.onSelect(t,g),w(),e.preventDefault(),e.stopPropagation()}),t===l&&(n.className+=" selected"),r.appendChild(n))}),d.appendChild(r),u.length<1){if(!a.emptyMsg)return void w();var e=s.createElement("div");e.className="empty",e.textContent=a.emptyMsg,d.appendChild(e)}d.parentNode||s.body.appendChild(d),function(){if(E()){c.height="auto",c.width=g.offsetWidth+"px";var l,u=0;e(),e(),a.customize&&l&&a.customize(g,l,d,u)}function e(){var e=s.documentElement,t=e.clientTop||s.body.clientTop||0,n=e.clientLeft||s.body.clientLeft||0,o=window.pageYOffset||e.scrollTop,i=window.pageXOffset||e.scrollLeft,r=(l=g.getBoundingClientRect()).top+g.offsetHeight+o-t,f=l.left+i-n;c.top=r+"px",c.left=f+"px",(u=window.innerHeight-(l.top+g.offsetHeight))<0&&(u=0),c.top=r+"px",c.bottom="",c.left=f+"px",c.maxHeight=u+"px"}}(),function(){var e=d.getElementsByClassName("selected");if(0<e.length){var t=e[0],n=t.previousElementSibling;if(n&&-1!==n.className.indexOf("group")&&!n.previousElementSibling&&(t=n),t.offsetTop<d.scrollTop)d.scrollTop=t.offsetTop;else{var o=t.offsetTop+t.offsetHeight,i=d.scrollTop+d.offsetHeight;i<o&&(d.scrollTop+=o-i)}}}()}function y(){E()&&L()}function b(){y()}function x(e){e.target!==d?y():e.preventDefault()}function C(e){for(var t=e.which||e.keyCode||0,n=0,o=[38,13,27,39,37,16,17,18,20,91,9];n<o.length;n++){if(t===o[n])return}112<=t&&t<=123||40===t&&E()||k(0)}function T(e){var t=e.which||e.keyCode||0;if(38===t||40===t||27===t){var n=E();if(27===t)w();else{if(u.length<1)return;(38===t?function(){if(u.length<1)l=void 0;else if(l===u[0])l=u[u.length-1];else for(var e=u.length-1;0<e;e--)if(l===u[e]||1===e){l=u[e-1];break}}:function(){if(u.length<1&&(l=void 0),l&&l!==u[u.length-1]){for(var e=0;e<u.length-1;e++)if(l===u[e]){l=u[e+1];break}}else l=u[0]})(),L()}return e.preventDefault(),void(n&&e.stopPropagation())}13===t&&(l&&(a.onSelect(l,g),w()),r&&e.preventDefault())}function N(){v&&k(1)}function k(e){var t=++m,n=g.value;n.length>=f||1===e?(h(),o=window.setTimeout(function(){a.fetch(n,function(e){m===t&&e&&(p=n,l=0<(u=e).length?u[0]:void 0,L())},0)},0===e?i:0)):w()}function D(){setTimeout(function(){s.activeElement!==g&&w()},200)}return d.className="autocomplete "+(a.className||""),c.position="absolute",d.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()}),d.addEventListener("focus",function(){return g.focus()}),g.addEventListener("keydown",T),g.addEventListener(n,C),g.addEventListener("blur",D),g.addEventListener("focus",N),window.addEventListener("resize",b),s.addEventListener("scroll",x,!0),{destroy:function(){g.removeEventListener("focus",N),g.removeEventListener("keydown",T),g.removeEventListener(n,C),g.removeEventListener("blur",D),window.removeEventListener("resize",b),s.removeEventListener("scroll",x,!0),h(),w()}}}});